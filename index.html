<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- A-Frame Imports -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.2.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <script
    src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
  <!-- Adding additional fonts and text-specific components -->
  <script src="https://unpkg.com/troika-three-text@0.46.4/dist/troika-three-text.umd.min.js"></script>
  <script src="https://unpkg.com/aframe-troika-text@0.7.0/dist/aframe-troika-text.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }

    /* Style for colored hearts in the title */
    .heart-green {
      color: #7bc97f;
    }

    .heart-blue {
      color: #a3d9ff;
    }

    /* Style for the page title */
    #title-overlay {
      position: fixed;
      top: 20px;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 100;
      font-family: Arial, sans-serif;
      font-size: 24px;
      color: #000000;
      text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
    }
  </style>
</head>

<body>
  <!-- Title with colored hearts -->
  <div id="title-overlay">
    Anna, ¿quieres ser la novia de Ethan? <span class="heart-green">&lt;3</span> <span class="heart-blue">&lt;3</span>
  </div>

  <a-scene light="defaultLightsEnabled: false" shadow>
    <a-assets timeout="10000">
      <a-asset-item id="frog_jump" src="/assets/frog_jump/scene.gltf"></a-asset-item>
    </a-assets>

    <!-- Environment - using the exact same forest preset with the original ground color -->
    <a-entity environment="preset: forest;" lighting="none" shadow></a-entity>

    <!-- Lights -->
    <a-light type="ambient" intensity="0.5"></a-light>
    <a-light type="directional" position="0 1 1" intensity="0.8" castShadow="true"></a-light>

    <!-- Camera -->
    <a-entity camera look-controls wasd-controls position="0 1.6 0" cursor="rayOrigin: mouse"></a-entity>

    <!-- Main question text -->
    <a-entity id="question-text" troika-text="value: Anna, ¿quieres ser la novia de Ethan?; 
                   color: #000000; 
                   fontSize: 0.4;
                   font: https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxP.woff;
                   align: center;
                   maxWidth: 4;" position="0 3.5 -4"></a-entity>

    <!-- Single frog that will move from right to left - initially hidden -->
    <a-entity id="hopping-frog" gltf-model="#frog_jump" scale="1 1 1" position="6 0.2 -2" rotation="0 -90 0"
      animation-mixer="clip: metarig|jump;" visible="false">
    </a-entity>

    <!-- Yes button with more prominent label -->
    <a-entity id="yes-box" position="-0.7 1.5 -4">
      <a-box scale="0.7 0.7 0.7" shadow color="#7bc97f" event-set__enter="_event: mouseenter; color: #4a9e50"
        event-set__leave="_event: mouseleave; color: #7bc97f" animation__mouseenter="
                property: rotation;
                startEvents: mouseenter;
                dur: 500;
                to: 0 10 0;
            " animation__mouseleave="
                property: rotation;
                startEvents: mouseleave;
                dur: 500;
                to: 0 0 0;
            " class="clickable"></a-box>
      <a-text value="YES" color="#ffffff" position="0 0 0.4" align="center" width="2" height="2" scale="2 2 2"
        font="monoid"></a-text>
    </a-entity>

    <!-- No button with more prominent label -->
    <a-entity id="no-box" position="0.7 1.5 -4">
      <a-box scale="0.7 0.7 0.7" shadow color="#ff6b6b" event-set__enter="_event: mouseenter; color: #e04949"
        event-set__leave="_event: mouseleave; color: #ff6b6b" animation__mouseenter="
                property: rotation;
                startEvents: mouseenter;
                dur: 500;
                to: 0 -10 0;
            " animation__mouseleave="
                property: rotation;
                startEvents: mouseleave;
                dur: 500;
                to: 0 0 0;
            " class="clickable"></a-box>
      <a-text value="NO" color="#ffffff" position="0 0 0.4" align="center" width="2" height="2" scale="2 2 2"
        font="monoid"></a-text>
    </a-entity>

    <!-- Simple success message -->
    <a-entity id="success-message" troika-text="value: Yay! You're the best!; 
                   color: #7bc97f; 
                   fontSize: 0.5;
                   font: https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxP.woff;
                   align: center;
                   maxWidth: 4;" position="0 3 -4" visible="false">
    </a-entity>
  </a-scene>

  <script>
    // Register the navigation component
    AFRAME.registerComponent('navigate-on-click', {
      schema: {
        url: { default: '' }
      },

      init: function () {
        var data = this.data;
        var el = this.el;

        el.addEventListener('click', function () {
          window.open(data.url, '_blank');
        });
      }
    });

    // Wait for scene to load
    document.querySelector('a-scene').addEventListener('loaded', function () {
      const noBox = document.getElementById('no-box');
      const yesBox = document.getElementById('yes-box');
      const questionText = document.getElementById('question-text');
      const hoppingFrog = document.getElementById('hopping-frog');
      const successMessage = document.getElementById('success-message');
      const titleOverlay = document.getElementById('title-overlay');

      // Check if elements exist (prevents null reference errors)
      if (!noBox || !yesBox || !questionText || !hoppingFrog || !successMessage) {
        console.error("One or more required elements not found in the DOM");
        return;
      }

      // Make the "No" button run away when clicked or hovered
      noBox.addEventListener('mouseenter', moveNoBox);
      noBox.addEventListener('click', moveNoBox);

      function moveNoBox() {
        // Generate random position within viewport
        const randomX = (Math.random() * 4) - 2;
        const randomY = (Math.random() * 3) + 0.5;
        const randomZ = -2 - (Math.random() * 1); // Keeps it in front of other elements

        // Animate to new position
        noBox.setAttribute('animation', {
          property: 'position',
          to: `${randomX} ${randomY} ${randomZ}`,
          dur: 300,
          easing: 'easeOutQuad'
        });
      }

      // When "Yes" is clicked, show the frog animation
      yesBox.addEventListener('click', function () {
        // Hide all UI elements
        yesBox.setAttribute('visible', 'false');
        noBox.setAttribute('visible', 'false');
        questionText.setAttribute('visible', 'false');

        // Safely hide the title overlay if it exists
        if (titleOverlay) {
          titleOverlay.style.display = 'none';
        }

        // Show the success message
        successMessage.setAttribute('visible', 'true');

        // Show the hopping frog
        hoppingFrog.setAttribute('visible', 'true');

        // Reset frog position
        hoppingFrog.setAttribute('position', '8 0.2 -2');

        // Start the frog animation
        startSimpleFrogAnimation();

        // Set a timeout to hide the success message after a few seconds
        setTimeout(function () {
          // Hide success message after 3 seconds to leave only the frog
          successMessage.setAttribute('visible', 'false');
        }, 3000);
      });

      // Simpler animation approach using continuous animation
      function startSimpleFrogAnimation() {
        // Create a simple animation that moves the frog from right to left
        // and then teleports it back to the start

        // This animation component will handle the continuous movement
        AFRAME.registerComponent('frog-hop', {
          init: function () {
            const frog = this.el;
            let startX = 8;  // Right side
            let endX = -8;   // Left side
            let hopDistance = 3; // Longer hop distance
            let currentX = startX;
            let animationRunning = false;

            // Function to start a single hop
            const startHop = () => {
              if (animationRunning) return;
              animationRunning = true;

              // Calculate next position
              const nextX = currentX - hopDistance;

              // If we've gone past the left edge, reset to right
              if (nextX < endX) {
                // Instantly move frog back to start
                frog.setAttribute('position', `${startX} 0.2 -2`);
                currentX = startX;
                animationRunning = false;
                setTimeout(startHop, 100); // Small delay before starting next hop
                return;
              }

              // Create the hop animation with a proper arc
              frog.setAttribute('animation__x', {
                property: 'position.x',
                from: currentX,
                to: nextX,
                dur: 700,
                easing: 'linear'
              });

              // Up and down animation for hopping
              frog.setAttribute('animation__y', {
                property: 'position.y',
                from: 0.2,
                to: 0.8,
                dir: 'alternate',
                dur: 700,
                easing: 'easeInOutQuad'
              });

              // Update current position
              currentX = nextX;

              // When animation completes, start next hop
              setTimeout(() => {
                animationRunning = false;
                startHop();
              }, 700 + 300); // Hop duration + small pause between hops
            };

            // Start the hopping sequence
            startHop();
          }
        });

        // Add the component to the frog to start the animation
        hoppingFrog.setAttribute('frog-hop', '');
      }
    });
  </script>
</body>

</html>